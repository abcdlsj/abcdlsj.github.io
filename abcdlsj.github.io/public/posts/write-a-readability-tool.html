
<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta charset="UTF-8" />
<title>Build a website for readability in 10 minutes</title>
<meta name="description" content="Enjoy Focus!" />

<meta name="keywords" content="Template,Readability,">
<meta name="author" content="abcdlsj">
<meta property="og:title" content="Build a website for readability in 10 minutes">
<meta property="og:description" content="Build a web readability tool in 10 minutes: Using Go and go-readability library to quickly create an online reader that extracts main content and removes distracting elements.">
<meta property="og:url" content="https://abcdlsj.github.io/posts/write-a-readability-tool.html">
<meta property="og:type" content="article">

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
<link rel="shortcut icon" href="/static/favicon.ico" />
<link rel="stylesheet" href="/static/style.css" />
<script>
  // Theme initialization - runs before page render to prevent flash
  (function() {
    const theme = localStorage.getItem('theme');
    if (theme) {
      document.documentElement.setAttribute('data-theme', theme);
    }
  })();
</script>
<script defer src="https://us.umami.is/script.js" data-website-id="5af61252-79b1-48a0-a452-fdeefbf6a3ee"></script>
<script src="/static/script/search.js"></script>

  </head>
  <body>
    <div class="app">
      
<header class="site-header">
  <div class="site-header__inner">
    <div class="site-header__brand">
      <a href="/" class="site-header__title">Build a website for readability in 10 minutes</a>
      <span class="site-header__tagline">Enjoy Focus!</span>
    </div>
    <nav class="site-header__nav">
      <ul class="nav-links">
        
        
        <li>
          <a href="/" class="nav-link">Home</a>
        </li>
        
        
        
        <li>
          <a href="/posts" class="nav-link">Posts</a>
        </li>
        
        
        
        <li>
          <a href="/about" class="nav-link">About</a>
        </li>
        
        
        
        
        
        <li>
          <a href="/rss.xml" class="nav-link">Feed</a>
        </li>
        
        
      </ul>
      <button class="theme-toggle" type="button" aria-label="Toggle theme" onclick="toggleTheme()">
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </nav>
  </div>
</header>
<script>
  function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    let newTheme;
    if (currentTheme === 'dark') {
      newTheme = 'light';
    } else if (currentTheme === 'light') {
      newTheme = 'dark';
    } else {
      // No explicit theme set, toggle based on system preference
      newTheme = prefersDark ? 'light' : 'dark';
    }
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  }
</script>

      <main class="container">
        <div class="post-layout ">
          <article class="post-article">
            <!-- Post Header -->
            <header class="post-header">
              
              <h1 class="post-title">Build a website for readability in 10 minutes</h1>
              <div class="post-meta">
                <time class="post-date" datetime="2023-10-22T11:51:37+08:00">2023-10-22</time>
                
                <div class="post-tags">
                  
                  <a href="/tags/template.html" class="tag">#Template</a>
                  
                  <a href="/tags/readability.html" class="tag">#Readability</a>
                  
                </div>
                
              </div>
            </header>

            

            <!-- Post Content -->
            <div class="post-body">
              <h2 id="background">Background</h2>
<p>Many websites use various CSS styles, and some of them can be challenging to read. One way to improve readability is to use a browser extension. Alternatively, you can create your own website <a href="https://www.wikiwand.com/en/Readability">WIKI - readability</a> tool. There are numerous language options and implementations available for this purpose. In this case, we will use <code>Go</code> to implement it. You will see how simple it is.</p>
<p>You can find all the code on my GitHub repository <a href="https://github.com/abcdlsj/share/tree/master/go/readability">here</a></p>
<h2 id="do-it">Do it</h2>
<p>Start by reading the example code for <a href="https://github.com/go-shiori/go-readability">go-readability</a> to understand its functionality and usage.</p>
<p>You can write the following code, which can be used as a command-line interface (CLI) tool.</p>
<pre tabindex="0" style="background-color:#fff;"><code><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#d14">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#d14">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#d14">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#d14">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#d14">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	readability <span style="color:#d14">&#34;github.com/go-shiori/go-readability&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">extract</span>(url <span style="color:#458;font-weight:bold">string</span>) readability.Article {
</span></span><span style="display:flex;"><span>	article, err <span style="color:#000;font-weight:bold">:=</span> readability.<span style="color:#900;font-weight:bold">FromURL</span>(url, <span style="color:#099">30</span><span style="color:#000;font-weight:bold">*</span>time.Second)
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#900;font-weight:bold">Fatalf</span>(<span style="color:#d14">&#34;failed to parse %s, %v\n&#34;</span>, url, err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Title   : %s\n&#34;</span>, article.Title)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Author  : %s\n&#34;</span>, article.Byline)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;SiteName: %s\n&#34;</span>, article.SiteName)
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Content : %s\n&#34;</span>, article.Content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">return</span> article
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">var</span> inputurl <span style="color:#458;font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>	flag.<span style="color:#900;font-weight:bold">StringVar</span>(<span style="color:#000;font-weight:bold">&amp;</span>inputurl, <span style="color:#d14">&#34;url&#34;</span>, <span style="color:#d14">&#34;&#34;</span>, <span style="color:#d14">&#34;URL&#34;</span>)
</span></span><span style="display:flex;"><span>	flag.<span style="color:#900;font-weight:bold">Parse</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">if</span> inputurl <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		flag.<span style="color:#900;font-weight:bold">Usage</span>()
</span></span><span style="display:flex;"><span>		os.<span style="color:#900;font-weight:bold">Exit</span>(<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#900;font-weight:bold">extract</span>(inputurl)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>It will work as expected.</p>
<p>However, there are instances where a terminal environment may not be available. In such cases, you can run it as a web server using Go's <code>http</code> package and <code>template</code> library to implement it. (In fact, I used <code>ChatGPT</code> to provide this demo. Cost 5 minute..)</p>
<p><strong>index.html</strong></p>
<pre tabindex="0" style="background-color:#fff;"><code><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">html</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#000080">title</span>&gt;Extract Article Content&lt;/<span style="color:#000080">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#000080">h1</span>&gt;Extract Article Content&lt;/<span style="color:#000080">h1</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#000080">form</span> <span style="color:#008080">action</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/read&#34;</span> <span style="color:#008080">method</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;post&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">label</span> <span style="color:#008080">for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;url&#34;</span>&gt;Enter URL:&lt;/<span style="color:#000080">label</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text&#34;</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;url&#34;</span> <span style="color:#008080">name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;url&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;submit&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;Extract&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#000080">form</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre><p><strong>article.html</strong></p>
<pre tabindex="0" style="background-color:#fff;"><code><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">html</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#000080">title</span>&gt;Article Content&lt;/<span style="color:#000080">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#000080">h1</span>&gt;{{.Title}}&lt;/<span style="color:#000080">h1</span>&gt;
</span></span><span style="display:flex;"><span>	{{if .ErrorMsg}}
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">p</span>&gt;{{.ErrorMsg}}&lt;/<span style="color:#000080">p</span>&gt;
</span></span><span style="display:flex;"><span>	{{else}}
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;content&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			{{.Content | safeHTML}}
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>	{{end}}
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre><p><strong>main.go</strong></p>
<pre tabindex="0" style="background-color:#fff;"><code><span style="display:flex;"><span><span style="color:#000;font-weight:bold">var</span> (
</span></span><span style="display:flex;"><span>    tmpl = <span style="color:#000;font-weight:bold">...</span>.
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>	http.<span style="color:#900;font-weight:bold">HandleFunc</span>(<span style="color:#d14">&#34;/&#34;</span>, index)
</span></span><span style="display:flex;"><span>	http.<span style="color:#900;font-weight:bold">HandleFunc</span>(<span style="color:#d14">&#34;/read&#34;</span>, read)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	log.<span style="color:#900;font-weight:bold">Fatal</span>(http.<span style="color:#900;font-weight:bold">ListenAndServe</span>(<span style="color:#d14">&#34;:8080&#34;</span>, <span style="color:#000;font-weight:bold">nil</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">index</span>(w http.ResponseWriter, r <span style="color:#000;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span>	err <span style="color:#000;font-weight:bold">:=</span> tmpl.<span style="color:#900;font-weight:bold">ExecuteTemplate</span>(w, <span style="color:#d14">&#34;index.html&#34;</span>, <span style="color:#000;font-weight:bold">nil</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		http.<span style="color:#900;font-weight:bold">Error</span>(w, err.<span style="color:#900;font-weight:bold">Error</span>(), http.StatusInternalServerError)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">read</span>(w http.ResponseWriter, r <span style="color:#000;font-weight:bold">*</span>http.Request) {
</span></span><span style="display:flex;"><span>	url <span style="color:#000;font-weight:bold">:=</span> r.<span style="color:#900;font-weight:bold">FormValue</span>(<span style="color:#d14">&#34;url&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	article, err <span style="color:#000;font-weight:bold">:=</span> readability.<span style="color:#900;font-weight:bold">FromURL</span>(url, <span style="color:#099">30</span><span style="color:#000;font-weight:bold">*</span>time.Second)
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#900;font-weight:bold">render</span>(w, Article{URL: url, ErrorMsg: err.<span style="color:#900;font-weight:bold">Error</span>()})
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#900;font-weight:bold">render</span>(w, Article{URL: url, Title: article.Title, Content: article.Content})
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">render</span>(w http.ResponseWriter, data Article) {
</span></span><span style="display:flex;"><span>	err <span style="color:#000;font-weight:bold">:=</span> tmpl.<span style="color:#900;font-weight:bold">ExecuteTemplate</span>(w, <span style="color:#d14">&#34;article.html&#34;</span>, data)
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		http.<span style="color:#900;font-weight:bold">Error</span>(w, err.<span style="color:#900;font-weight:bold">Error</span>(), http.StatusInternalServerError)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><p>Implementing it as a web server is also straightforward.</p>
<h2 id="pack">Pack</h2>
<p>Once we have the web server set up, it is generally a best practice to package it into a Docker image.</p>
<p>So you may need to pack the files <code>index.html</code> and <code>article.html</code> into a Docker image. In Go, you can use <code>embed</code> to embed these files into the binary.</p>
<pre tabindex="0" style="background-color:#fff;"><code><span style="display:flex;"><span><span style="color:#000;font-weight:bold">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#998;font-style:italic">//go:embed *.html
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>	tmplFiles embed.FS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	funcMap = template.FuncMap{
</span></span><span style="display:flex;"><span>		<span style="color:#d14">&#34;safeHTML&#34;</span>: <span style="color:#000;font-weight:bold">func</span>(content <span style="color:#458;font-weight:bold">string</span>) template.HTML {
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">return</span> template.<span style="color:#900;font-weight:bold">HTML</span>(content)
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	tmpl = template.<span style="color:#900;font-weight:bold">Must</span>(template.<span style="color:#900;font-weight:bold">New</span>(<span style="color:#d14">&#34;article.html&#34;</span>).<span style="color:#900;font-weight:bold">Funcs</span>(funcMap).<span style="color:#900;font-weight:bold">ParseFS</span>(tmplFiles, <span style="color:#d14">&#34;article.html&#34;</span>, <span style="color:#d14">&#34;index.html&#34;</span>))
</span></span><span style="display:flex;"><span>)
</span></span></code></pre><p><code>embed</code> will embed files at <code>compile</code> time.</p>
<h2 id="docker">Docker</h2>
<h3 id="dockerfile">Dockerfile</h3>
<p><code>Go</code> is a cross-platform programming language, you can copy the binary files into a base image to execute it. Here's an example of a Dockerfile:</p>
<p>Sample:</p>
<pre tabindex="0" style="background-color:#fff;"><code><span style="display:flex;"><span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#d14"> alpine:latest</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">RUN</span> mkdir /app<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">WORKDIR</span><span style="color:#d14"> /app</span><span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">COPY</span> . .<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#000;font-weight:bold">CMD</span> [<span style="color:#d14">&#34;/app/readability&#34;</span>]<span style="color:#a61717;background-color:#e3d2d2">
</span></span></span></code></pre><p>This Dockerfile copies the readability library into the image. Therefore, you need to compile it first using the command <code>CGO_ENABLED=0 GOOS=linux go build -o readability</code>.</p>
<p>I have also written a simple tool called nestg for packing binary files into a Docker image. You can find it at <a href="https://github.com/abcdlsj/share/tree/master/go/nestg">share/nestg</a></p>
<pre><code>Usage of nestg:
  -b string
        go build flags
  -i string
        image name
  -p string
        port
</code></pre>
<p>Use <code>nestg</code></p>
<pre><code>nestg -i abcdlsj/readability -p 8080
</code></pre>
<h3 id="run">Run</h3>
<p>After building the Docker image, you can run it using the following command:</p>
<p><code>docker run -it --rm -p &lt;HOST_PORT&gt;:8080 abcdlsj/readability</code></p>
<p>Now you can access the website at <code>http://localhost:&lt;HOST_PORT&gt;</code>.</p>
<p>That's all of things you can done within 10 minute. Then, I will optimize it!</p>
<h2 id="optimize">Optimize</h2>
<h3 id="protect-double-slashes"><code>Protect</code> double slashes</h3>
<p>You can enhance the functionality by utilizing URL parameters, making it more useful. I attempted to add an HTTP URL to the path, but encountered a problem with the parser.</p>
<p>For example, when you make a request to <code>https://xxx.com/read/https://nautil.us/mirror-image-life-412729/</code>, the appended path becomes <code>https:/nautil.us/mirror-image-life-412729</code> due to the modification of <code>//</code> to <code>/</code>. This behavior is a result of the following explanation from the documentation:</p>
<blockquote>
<p>ServeMux also takes care of sanitizing the URL request path and the Host header, stripping the port number and redirecting any request containing . or .. elements or repeated slashes to an equivalent, cleaner URL.</p>
</blockquote>
<p>This information was obtained from the documentation found at <a href="https://pkg.go.dev/net/http#ServeMux">net/http#ServeMux</a></p>
<p>I came across some useful links that discuss this issue:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/55716545/url-escaped-parameter-not-resolving-properly">Stack Overflow - URL-escaped parameter not resolving properly</a></li>
<li><a href="https://stackoverflow.com/questions/51908277/how-do-i-get-gos-net-http-package-to-stop-removing-double-slashes">Stack Overflow - How do I get Go's net/http package to stop removing double slashes?</a></li>
<li><a href="https://github.com/golang/go/issues/42244">Github issue - net/http: ServeMux forcibly cleans double forward slash in URLs even when behaving as a gateway</a></li>
</ul>
<p>The suggested solution is to use <code>https://github.com/gorilla/mux</code> or implement your own <code>ServeMux</code>. By using gorilla/mux, you simply need to call <code>SkipClean(true)</code>. After doing this, the double slashes won't be removed.</p>
<h3 id="httpredirect-clean-double-slashes"><code>http.Redirect</code> clean double slashes</h3>
<p>However, I encountered another issue when using redirects after submitting a link form. The redirect operation also removes the double slashes from the URL path, and unfortunately, <code>gorilla/mux</code> does not support handling this situation.</p>
<p>Because <code>http.Redirect</code> call <code>url = path.Clean(url)</code> to clean the URL, it also will <code>clean</code> double slashes.</p>
<blockquote>
<p>Can see code <a href="https://github.com/golang/go/blob/8c92897e15d15fbc664cd5a05132ce800cf4017f/src/net/http/server.go#L2247C25-L2247C25">/src/net/http/server.go</a></p>
</blockquote>
<p>Luckily, there is a workaround available. You can escape the <code>/</code> characters as <code>%2F</code> to prevent the removal of double slashes during the redirect process.</p>
<p>You can find this version of the code at <a href="https://github.com/abcdlsj/share/tree/909fcb5e80fef9ecfaf68259ae98fb6694d3e984/go/readability">readability - 909fcb5e80fe</a>. Please note that there are some additional adjustments made as well.</p>
<h2 id="pictures">Pictures</h2>
<p>After adding some simple <code>CSS</code> to the <code>HTML template</code>, you will see the result:</p>
<img alt="homepage" src="/static/img/readability_screenshot2.png" width="100%" style="border: 1px solid gray;">
<img alt="article page" src="/static/img/readability_screenshot.png" width="100%"  style="border: 1px solid gray;">
<blockquote>
<p>04/14/2024 Update:<br>
Add recently viewed using <code>Redis</code> <code>list</code> to store, and <code>zset</code> store view count <a href="https://github.com/abcdlsj/share/commit/08837c71ff065791a400b976fa23ca2fd338d5bc">commit</a>.</p>
</blockquote>
<img alt="`recently` homepage" src="/static/img/readability_screenshot3.png" width="100%"  style="border: 1px solid gray;">
<h2 id="conclusion">Conclusion</h2>
<p>This is a small weekend project.</p>
<p>Thanks for reading!</p>

            </div>
          </article>

          
        </div>

        <!-- Comments -->
        <section class="comments-section">
          <div id="disqus_thread"></div>
        </section>
      </main>
      
<footer class="footer">
  <div class="footer__inner">
    <p>Â© 2024 <a href="https://github.com/abcdlsj">abcdlsj</a></p>
    <p><a href="https://github.com/abcdlsj/abcdlsj.github.io">Source</a></p>
  </div>
</footer>

    </div>

    <button class="back-to-top" type="button" aria-label="Back to top" onclick="scrollToTop()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"></polyline>
      </svg>
    </button>

    <script>
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      const backToTop = document.querySelector(".back-to-top");
      const toggleButton = () => {
        if (!backToTop) return;
        backToTop.classList.toggle("back-to-top--visible", window.scrollY > 400);
      };
      window.addEventListener("scroll", toggleButton);

      // Smooth scroll for TOC links
      document.addEventListener('DOMContentLoaded', function() {
        const tocLinks = document.querySelectorAll('.toc-nav a');
        tocLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth' });
            }
          });
        });

        // TOC scroll tracking
        const tocNav = document.querySelector('.toc-nav');
        if (tocNav) {
          const headings = document.querySelectorAll('.post-body h2, .post-body h3');
          const tocLinks = Array.from(tocNav.querySelectorAll('a'));
          
          function updateActiveHeading() {
            let activeId = '';
            
            // Find the heading currently in view
            for (let i = 0; i < headings.length; i++) {
              const rect = headings[i].getBoundingClientRect();
              if (rect.top <= 150) {  // 150px from top
                activeId = headings[i].id;
              }
            }
            
            // Update TOC active state
            tocLinks.forEach(link => {
              link.classList.remove('active');
              if (link.getAttribute('href') === '#' + activeId) {
                link.classList.add('active');
              }
            });
          }
          
          // Throttle scroll events for performance
          let ticking = false;
          window.addEventListener('scroll', function() {
            if (!ticking) {
              requestAnimationFrame(function() {
                updateActiveHeading();
                ticking = false;
              });
              ticking = true;
            }
          });
          
          // Initial call
          updateActiveHeading();
        }
      });

      // Disqus
      (function() {
        var d = document, s = d.createElement("script");
        s.src = "https://abcdlsj.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </body>
</html>
